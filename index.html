<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="48x48" href="/favicon-48x48.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/favicon-192x192.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="manifest" href="/manifest.json">
    <meta name="msapplication-TileImage" content="/favicon-192x192.png">
    <meta name="msapplication-TileColor" content="#000000">
    <meta name="theme-color" content="#d4af37">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- HashRouter fallback: convert direct deep links (/buscar) into hash routes (/#/buscar) to avoid 404 on hosts without SPA rewrites -->
    <script>
      (function () {
        try {
          var path = window.location.pathname || "/";
          // Meta OAuth callback handler — intercept before HashRouter redirect
          if (path === "/api/meta/oauth/callback" || path === "/api/meta/webhook") {
            var params = new URLSearchParams(window.location.search);
            var code = params.get("code");
            if (code) {
              // Show connecting UI immediately
              document.title = "Conectando WhatsApp...";
              document.body.innerHTML = '<div style="display:flex;align-items:center;justify-content:center;height:100vh;font-family:sans-serif;background:#111;color:#fff"><div style="text-align:center"><p style="font-size:1.2rem">✅ Conectando WhatsApp...</p><p style="color:#888;margin-top:8px">Processando autenticação...</p></div></div>';
              
              // Try postMessage to opener (popup flow)
              if (window.opener) {
                try {
                  window.opener.postMessage({ type: "META_OAUTH_CALLBACK", code: code }, "*");
                  document.querySelector("p:last-child").textContent = "Esta janela fechará automaticamente.";
                  setTimeout(function(){ window.close(); }, 2000);
                } catch(e) {
                  // opener blocked by cross-origin, fall through to direct API call
                }
              }
              
              // Fallback: call the edge function directly if no opener or cross-origin blocked
              if (!window.opener) {
                var supabaseUrl = "https://ypkmorgcpooygsvhcpvo.supabase.co";
                var anonKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inlwa21vcmdjcG9veWdzdmhjcHZvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY5ODY1MjAsImV4cCI6MjA3MjU2MjUyMH0.A8MoJFe_ACtVDl7l0crAyU7ZxxOhdWJ8NShaqSHBxQc";
                document.querySelector("p:last-child").textContent = "Finalizando conexão...";
                fetch(supabaseUrl + "/functions/v1/meta-oauth-callback", {
                  method: "POST",
                  headers: { "Content-Type": "application/json", "apikey": anonKey, "Authorization": "Bearer " + anonKey },
                  body: JSON.stringify({ code: code, redirect_uri: "https://supremeempreendimentos.com/api/meta/oauth/callback" })
                }).then(function(r){ return r.json(); }).then(function(data){
                  if (data.success) {
                    document.querySelector("p").textContent = "✅ WhatsApp conectado com sucesso!";
                    document.querySelector("p:last-child").textContent = "Você pode fechar esta janela.";
                  } else {
                    document.querySelector("p").textContent = "❌ Erro na conexão";
                    document.querySelector("p:last-child").textContent = data.error || "Tente novamente.";
                  }
                }).catch(function(err){
                  document.querySelector("p").textContent = "❌ Erro de conexão";
                  document.querySelector("p:last-child").textContent = err.message;
                });
              }
              return; // stop — don't redirect to hash route
            }
          }
          // HashRouter fallback: convert direct deep links (/buscar) into hash routes (/#/buscar)
          var hasHash = window.location.hash && window.location.hash.length > 1;
          if (!hasHash && path !== "/") {
            var newUrl = window.location.origin + "/#" + path + (window.location.search || "");
            window.location.replace(newUrl);
          }
        } catch (e) {
          // ignore
        }
      })();
    </script>

    <!-- Chat Widget vanilla JS removido - OminChat React ativo -->

    <title>Supreme Negócios Imobiliários - Imóveis de Luxo e Alto Padrão em Goiânia</title>
    <meta name="description" content="Supreme Negócios Imobiliários - Imóveis de luxo e alto padrão em Goiânia. Casas em condomínio fechado, coberturas, mansões no Setor Marista, Setor Bueno, Setor Oeste e Jardim Goiás. Segurança 24h e localização privilegiada." />
    <meta name="author" content="Supreme Negócios Imobiliários" />
    <meta name="keywords" content="imóveis de luxo goiânia, jardim goiás, setor marista, setor bueno, setor oeste, casa em condomínio fechado, alto padrão, condomínio fechado, cobertura, casa grande, mansão, suítes, acabamento premium, piscina privativa, jardins, vista panorâmica, arquitetura moderna, segurança 24h, localização privilegiada, imóveis goiânia" />

    <meta property="og:title" content="Supreme Negócios Imobiliários - Imóveis de Luxo e Alto Padrão em Goiânia" />
    <meta property="og:description" content="Imóveis de luxo e alto padrão em Goiânia. Casas em condomínio fechado, coberturas e mansões no Setor Marista, Setor Bueno, Setor Oeste e Jardim Goiás. Segurança 24h e localização privilegiada." />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="https://lovable.dev/opengraph-image-p98pqg.png" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@supremeimoveis" />
    <meta name="twitter:image" content="https://lovable.dev/opengraph-image-p98pqg.png" />

    <!-- Meta Pixel Code -->
    <script>
    !function(f,b,e,v,n,t,s)
    {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
    n.callMethod.apply(n,arguments):n.queue.push(arguments)};
    if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
    n.queue=[];t=b.createElement(e);t.async=!0;
    t.src=v;s=b.getElementsByTagName(e)[0];
    s.parentNode.insertBefore(t,s)}(window, document,'script',
    'https://connect.facebook.net/en_US/fbevents.js');
    fbq('init', '1565894884246112');
    fbq('track', 'PageView');
    </script>
    <!-- End Meta Pixel Code -->

    <!-- Google Search Console Verification -->
    <meta name="google-site-verification" content="N2n_nQJ9_zJFqWJ..." />

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-S0S0PG91SK"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-S0S0PG91SK');
    </script>
  </head>

  <body>
    <!-- Meta Pixel noscript (must be in body) -->
    <noscript><img height="1" width="1" style="display:none"
    src="https://www.facebook.com/tr?id=1565894894246112&ev=PageView&noscript=1"
    /></noscript>
    
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
